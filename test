import React, { useState, useEffect } from "react";
import DatePicker from "react-datepicker";
import "react-datepicker/dist/react-datepicker.css";
import { useNavigate } from "react-router-dom";

function Booking2() {
  const [checkInDate, setCheckInDate] = useState(new Date());
  const [checkOutDate, setCheckOutDate] = useState(new Date());
  const [adults, setAdults] = useState(2);
  const [children, setChildren] = useState(0);
  const [room, setRoom] = useState(null); // Thêm state để lưu thông tin phòng từ rooms[0]

  const navigate = useNavigate();

  useEffect(() => {
    // Lấy dữ liệu từ localStorage
    const bookingInfo = localStorage.getItem("bookingInfo");
    const rooms = localStorage.getItem("rooms");

    if (bookingInfo) {
      const parsedInfo = JSON.parse(bookingInfo);
      if (parsedInfo.IssueDate) setCheckInDate(new Date(parsedInfo.IssueDate));
      if (parsedInfo.DueDate) setCheckOutDate(new Date(parsedInfo.DueDate));
      if (parsedInfo.adult) setAdults(parsedInfo.adult);
      if (parsedInfo.children) setChildren(parsedInfo.children);
    }

    if (rooms) {
      const parsedRooms = JSON.parse(rooms);
      if (parsedRooms.length > 0) {
        setRoom(parsedRooms[0]); // Lấy thông tin phòng đầu tiên
      }
    }
  }, []);

  const handleBack = () => {
    navigate("/Booking");
  };

  return (
    <div>
      <div className="gdlr-page-title-wrapper">
        <div className="gdlr-page-title-overlay" />
        <div className="gdlr-page-title-container container">
          <h1 className="gdlr-page-title">Đặt phòng</h1>
        </div>
      </div>
      <div className="content-wrapper">
        <div className="gdlr-content">
          <div className="with-sidebar-wrapper">
            <div className="with-sidebar-container container gdlr-class-no-sidebar">
              <div className="with-sidebar-left twelve columns">
                <div className="with-sidebar-content twelve columns">
                  <div
                    className="gdlr-item gdlr-item-start-content"
                    id="gdlr-single-booking-content"
                  >
                    <form className="gdlr-reservation-bar">
                      <div className="gdlr-reservation-bar-title">
                        Đặt phòng cho bạn
                      </div>
                      <div className="gdlr-reservation-bar-date-form">
                        {/* Thời gian vào */}
                        <div className="gdlr-reservation-field gdlr-resv-datepicker">
                          <span className="gdlr-reservation-field-title">
                            Thời gian vào
                          </span>
                          <div className="gdlr-datepicker-wrapper">
                            <DatePicker
                              selected={checkInDate}
                              onChange={(date) => setCheckInDate(date)}
                              dateFormat="dd/MM/yyyy"
                              minDate={new Date()}
                              className="gdlr-datepicker"
                            />
                          </div>
                        </div>
                        <div className="clear" />
                        {/* Thời gian ra */}
                        <div className="gdlr-reservation-field gdlr-resv-datepicker">
                          <span className="gdlr-reservation-field-title">
                            Thời gian ra
                          </span>
                          <div className="gdlr-datepicker-wrapper">
                            <DatePicker
                              selected={checkOutDate}
                              onChange={(date) => setCheckOutDate(date)}
                              dateFormat="dd/MM/yyyy"
                              minDate={checkInDate}
                              className="gdlr-datepicker"
                            />
                          </div>
                        </div>
                        <div className="clear" />
                        <div
                          className="gdlr-reservation-field gdlr-resv-combobox "
                          style={{
                            marginBottom: "50px",
                            marginTop: "50px",
                            color: "#b89f80",
                          }}
                        >
                          <span>Xác nhận thông tin của bạn!</span>
                        </div>
                        <div className="clear" />
                        {/* Nút Quay lại */}
                        <button
                          type="button"
                          id="gdlr-reservation-bar-button"
                          className="gdlr-reservation-bar-button gdlr-button with-border"
                          onClick={handleBack}
                        >
                          Quay lại
                        </button>
                        <div className="clear" />
                      </div>
                      <div
                        className="gdlr-reservation-bar-service-form"
                        id="gdlr-reservation-bar-service-form"
                      />
                    </form>
                    <div className="gdlr-booking-content">
                      <div className="gdlr-booking-room-wrapper">
                        {/* Hiển thị thông tin phòng */}
                        {room && (
                          <div className="gdlr-item gdlr-room-item gdlr-medium-room">
                            <div className="gdlr-ux gdlr-medium-room-ux">
                              <div className="gdlr-room-thumbnail">
                                <img
                                  src="https://via.placeholder.com/400x300" // Placeholder nếu không có ảnh
                                  alt={room.room_name}
                                  width={400}
                                  height={300}
                                />
                              </div>
                              <div className="gdlr-room-content-wrapper">
                                <h3 className="gdlr-room-title">
                                  {room.room_name || "Tên phòng"}
                                </h3>
                                <div className="gdlr-hotel-room-info">
                                  <div className="gdlr-room-info">
                                    <i className="fa fa-check-square-o icon-check" />
                                    <span className="gdlr-head">Giá:</span>
                                    <span className="gdlr-tail">
                                      {room.price || "Không có giá"} / đêm
                                    </span>
                                  </div>
                                  <div className="gdlr-room-info">
                                    <i className="fa fa-check-square-o icon-check" />
                                    <span className="gdlr-head">Trạng thái:</span>
                                    <span className="gdlr-tail">
                                      {room.status === 1
                                        ? "Còn trống"
                                        : "Đã đặt"}
                                    </span>
                                  </div>
                                </div>
                                <div className="gdlr-room-content">
                                  Thông tin thêm:{" "}
                                  {room.more_service || "Không có thông tin"}
                                </div>
                                <a
                                  className="gdlr-room-selection gdlr-button with-border"
                                  href="#"
                                  data-roomid={room.id}
                                >
                                  Chọn phòng này
                                </a>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>
                      <div className="clear" />
                    </div>
                  </div>
                  <div className="" style={{ marginBottom: "100px" }}></div>
                </div>
                <div className="clear" />
              </div>
              <div className="clear" />
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

export default Booking2;